# Session Notes: 2025-12-05 (Part 2) - Nexus Integration Review

## Session Summary

Reviewed Nexus team documentation and finalized integration architecture between Mnemo and Nexus.

## Work Completed

### 1. Document Review
- ✅ Reviewed Nexus TEAM-LEADER-SUMMARY.md
- ✅ Reviewed Nexus ROADMAP.md
- ✅ Reviewed Nexus DEVELOPER-DOC-PROPOSALS.md
- ✅ Analyzed integration points and potential conflicts

### 2. Integration Architecture Finalized

**Confirmed Agreements**:
- ✅ Nexus owns Gmail adapter/fetch (Mnemo stays generic)
- ✅ Nexus pre-fetches context before DE escalation (keeps DE stateless)
- ✅ Cost attribution: `requester + userId + tenantId`
- ✅ Nexus owns WARM/COLD tier compression (Mnemo only handles HOT)

**Mnemo Answers to Nexus Questions**:
1. **Email data interface**: Plain text + structured JSON, max 50KB per email
2. **Cache naming convention**: Enforce `{service}-{type}-{identifier}[-{scope}]` pattern
3. **TTL strategy**: 1h (email), 8h (project), 24h (CRM) with dynamic learning
4. **Proactive loading**: Event-driven (Tier 1) + activity-based (Tier 2)
5. **Cache eviction notifications**: Webhook with HMAC signature (v0.3 feature)
6. **Multi-source loading**: Already supported via composite loading
7. **Cost tracking**: All levels (per-cache, per-query, per-service, per-user, per-tenant)
8. **Pattern learning**: `reportUsage()` API + recommendations (v0.3-v0.4)

### 3. Mnemo Roadmap Updates

**New v0.3 Features** (for Nexus integration):
- Add `DataAdapter` for generic structured data
- Add `requester`, `userId`, `tenantId` parameters to all API calls
- Implement cache naming validation and helper function
- Add webhook system for cache eviction notifications
- Enhance `context_stats()` with per-service/user/tenant breakdowns
- Add `reportUsage()` API for pattern learning feedback
- Document email data interface format

**New v0.4 Features** (pattern learning):
- Implement usage pattern tracking
- Provide loading recommendations API
- Analyze cost efficiency by context type
- TTL optimization suggestions

## Architecture Decisions

### Email/Calendar Adapter Ownership
**Decision**: Nexus owns Gmail API integration, Mnemo provides generic data adapter
- Nexus fetches emails via OAuth
- Nexus formats data (plain text + metadata)
- Mnemo accepts via `DataAdapter` (new v0.3 feature)

### Context Loading Pattern
**Decision**: Nexus pre-fetches context before DE escalation
```
Nexus → Mnemo (query context) → Nexus (craft prompt) → DE (execute)
```
- DE remains stateless
- Nexus orchestrates all context management

### Memory Tier Ownership
**Decision**: Clear separation of responsibilities
- HOT (Mnemo): 1M token Gemini cache, fast queries
- WARM (Nexus D1): Compressed summaries
- COLD (Nexus D1): Full historical data

### Cost Attribution
**Decision**: Three-level tracking
- Service level: `requester: 'nexus' | 'bridge' | 'de'`
- User level: `userId` for per-user billing
- Tenant level: `tenantId` for per-organization billing

## Integration Points Summary

```
Nexus ↔ Mnemo Integration:

1. context_load()
   - Multi-source composite loading
   - Email data format (plain text + JSON)
   - Cache naming: nexus-{type}-{identifier}
   - Tracking: requester + userId + tenantId

2. context_query()
   - Pre-fetch before DE escalation
   - Track query usage for pattern learning

3. Webhooks (v0.3)
   - cache.evicted → Nexus compresses to WARM
   - HMAC signature for security

4. reportUsage() (v0.3)
   - Nexus reports context usefulness
   - Enables pattern learning and optimization

5. context_stats()
   - Cost attribution (per-service, per-user, per-tenant)
   - Usage analytics for billing
```

## Next Steps

### For Mnemo (High Priority):
- [ ] Implement v0.3 features for Nexus integration
- [ ] Add `DataAdapter` for structured data
- [ ] Add tracking parameters (requester, userId, tenantId)
- [ ] Implement webhook system
- [ ] Enhance stats API

### For Nexus (High Priority):
- [ ] Implement Gmail integration (v0.3)
- [ ] Format email data per Mnemo spec
- [ ] Adopt cache naming convention
- [ ] Implement webhook handler for eviction notifications
- [ ] Start event-driven proactive loading

### Cross-Team:
- [ ] Test integration with mock data
- [ ] Validate cost attribution pipeline
- [ ] Document integration patterns
- [ ] Create shared integration test suite

## Files Modified

None (documentation review only).

## Files Created

- `/home/chris/mnemo/docs/session-notes/2025-12-05-part2.md` (this file)

## Key Decisions

1. **Adapter ownership**: Nexus owns external API integrations (Gmail, Calendar, Zoom)
2. **Context flow**: Nexus → Mnemo → Nexus → DE (Nexus orchestrates)
3. **Memory tiers**: Mnemo (HOT), Nexus (WARM/COLD)
4. **Cost tracking**: Three-level (service, user, tenant)
5. **Proactive loading**: Event-driven (Tier 1), activity-based (Tier 2)

## Notes

- Strong alignment between teams ✅
- No architectural conflicts identified ✅
- Clear integration plan established ✅
- Action items documented for both teams ✅

## Commits

All previous commits from Part 1 of session:
- `f774be1` - docs: clarify Mnemo's role in ecosystem
- `cdb55f1` - docs: track submitted developer guide proposals

## Session Duration

~2 hours (Part 1 + Part 2 combined)

## Status

✅ **Session complete** - Ready for Nexus v0.3 Gmail integration and Mnemo v0.3 feature development.
